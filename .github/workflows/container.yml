name: 'container'

on:
    push:
    schedule:
        -   cron: '0 7 * * MON'

jobs:
    release:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v1

            -   name: Inject slug/short variables
                uses: rlespinasse/github-slug-action@v2.x

            -   name: Get build time
                uses: 1466587594/get-current-time@v1
                id: current-time

            -   name: Dockerhub login
                run: |
                    echo "${{ secrets.DOCKER_TOKEN }}" | docker login --username ${{ secrets.DOCKER_USERNAME }} --password-stdin

            -   name: Build docker image
                run: |
                    docker build \
                    --build-arg BUILD_DATE=${{ steps.current-time.outputs.time }} \
                    --build-arg VCS_REF=${{ env.GITHUB_SHA_SHORT }} \
                    -t "${{ secrets.DOCKER_IMAGE }}:latest" .

            -   name: docker push
                run: docker push ${{ secrets.DOCKER_IMAGE }}:latest
